# encoding: utf-8

##=== Get weather forecast from AccuWeather ===#
##=== exlab, Jan. 08, 2019 ===#
##=== version 1.0 ===#
##=== version 1.1, Jan 10, 2019 ===#
##==================#

## Config in configuration.yaml file for Home Assistant
## weather_forecast:

## Code script:
###tts_fpt.say
##read_weather:
##  sequence:
##    - service: weather_forecast.get
##      data:
##        place_id: 'ha-noi.gia-lam-pho'
##        tts_service: 'tts_fpt.say'
##        entity_id: 'media_player.room_player'
##        voice_type: 'nu_mien_bac' # optional, default = 'nu_mien_bac'
###tts.google_say
##read_weather2:
##  sequence:
##    - service: weather_forecast.get
##      data:
##        place_id: 'ha-noi.gia-lam-pho'
##        tts_service: 'tts.google_say'
##        entity_id: 'media_player.room_player'
##        cache: false # optional, default = false
##==================#

from bs4 import BeautifulSoup as bs
import requests

## config
DOMAIN = 'weather_forecast'
SERVICE_GETINFO = 'get'

## data service
CONF_PLACE = 'place_id'
CONF_TTS_SERVICE = 'tts_service'
CONF_ENTITY_ID = 'entity_id'
## 'tts.google_say'
CONF_CACHE = 'cache'
## 'tts_fpt.say'
CONF_VOICE = 'voice_type'

## data place
places = {'lai-cau.ban-cheng-nuo': 'ban-cheng-nuo/354276', 'lai-cau.ban-ko-la': 'ban-ko-la/354278', 'lai-cau.ban-nam-che': 'ban-nam-che/354279', 'lai-cau.ban-nam-muong': 'ban-nam-muong/354280', 'lai-cau.ban-pa-thang': 'ban-pa-thang/354281', 'lai-cau.lai-chau': 'lai-chau/353000', 'lai-cau.ma-li-chai': 'ma-li-chai/354282', 'lai-cau.muong-boum': 'muong-boum/354283', 'lai-cau.muong-te': 'muong-te/354284', 'lai-cau.nam-bon': 'nam-bon/354285', 'lai-cau.phong-tho': 'phong-tho/354286', 'lao-cai.bac-ha': 'bac-ha/354306', 'lao-cai.ban-kung': 'ban-kung/354313', 'lao-cai.ban-la': 'ban-la/354314', 'lao-cai.ban-xeo': 'ban-xeo/354315', 'lao-cai.bao-yen': 'bao-yen/354307', 'lao-cai.cam-duong': 'cam-duong/354308', 'lao-cai.cha-pai': 'cha-pai/354309', 'lao-cai.coc-leu': 'coc-leu/428001', 'lao-cai.ha-nam': 'ha-nam/354310', 'lao-cai.lao-cai': 'lao-cai/354305', 'lao-cai.muong-bo': 'muong-bo/354317', 'lao-cai.nam-bai': 'nam-bai/354318', 'lao-cai.nam-khap-ban-tang': 'nam-khap-ban-tang/354319', 'lao-cai.pac-ta-1': 'pac-ta/354311', 'lao-cai.pac-ta-2': 'pac-ta/354312', 'lao-cai.pho-lu': 'pho-lu/354322', 'lao-cai.van-ban': 'van-ban/354323', 'ha-giang.bac-ba': 'bac-ba/353390', 'ha-giang.bac-me': 'bac-me/353391', 'ha-giang.bac-quang': 'bac-quang/353392', 'ha-giang.ban-thuy': 'ban-thuy/353393', 'ha-giang.ban-vai': 'ban-vai/353394', 'ha-giang.cho-kem': 'cho-kem/353395', 'ha-giang.ha-giang': 'ha-giang/353389', 'ha-giang.lang-cay': 'lang-cay/353396', 'ha-giang.loung-hoa': 'loung-hoa/353397', 'ha-giang.meo-vac': 'meo-vac/353403', 'ha-giang.nam-ric': 'nam-ric/353398', 'ha-giang.tchoung-sao': 'tchoung-sao/353399', 'ha-giang.thanh-thuy': 'thanh-thuy/353400', 'ha-giang.vinh-tuy': 'vinh-tuy/353401', 'ha-giang.yen-binh-xa': 'yen-binh-xa/353402', 'cao-bang.ban-cao': 'ban-cao/352514', 'cao-bang.ban-duong': 'ban-duong/352513', 'cao-bang.ban-giam': 'ban-giam/352515', 'cao-bang.cao-bang': 'cao-bang/352511', 'cao-bang.ha-lang': 'ha-lang/352525', 'cao-bang.khau-khang': 'khau-khang/352516', 'cao-bang.lang-den': 'lang-den/352517', 'cao-bang.na-giao': 'na-giao/352518', 'cao-bang.na-loung': 'na-loung/352519', 'cao-bang.na-young': 'na-young/352520', 'cao-bang.nam-lang': 'nam-lang/352521', 'cao-bang.nam-nhung': 'nam-nhung/352522', 'cao-bang.pac-boc': 'pac-boc/352512', 'cao-bang.quang-dau': 'quang-dau/352524', 'son-la.ban-lot': 'ban-lot/355948', 'son-la.ban-na-tong': 'ban-na-tong/355950', 'son-la.ban-pho': 'ban-pho/355951', 'son-la.ban-vay': 'ban-vay/355946', 'son-la.bang-beng': 'bang-beng/355952', 'son-la.chieng-pan': 'chieng-pan/355953', 'son-la.lao-phou-van': 'lao-phou-van/355954', 'son-la.muong-leo': 'muong-leo/355955', 'son-la.quynh-nhai': 'quynh-nhai/355956', 'son-la.son-la': 'son-la/355945', 'son-la.song-ma': 'song-ma/355947', 'yen-bai.ba-khe': 'ba-khe/356427', 'yen-bai.lang-than': 'lang-than/356428', 'yen-bai.nghia-lo': 'nghia-lo/356429', 'yen-bai.phu-hien': 'phu-hien/356430', 'yen-bai.poun-loung': 'poun-loung/356431', 'yen-bai.trai-hut': 'trai-hut/356432', 'yen-bai.tu-le': 'tu-le/356426', 'yen-bai.van-an': 'van-an/356433', 'yen-bai.yen-bai': 'yen-bai/356425', 'tuyen-quang.ban-coc': 'ban-coc/356321', 'tuyen-quang.chiem-hoa': 'chiem-hoa/356323', 'tuyen-quang.dai-th': 'dai-th/356320', 'tuyen-quang.dong-tong-bang': 'dong-tong-bang/356324', 'tuyen-quang.ham-yen': 'ham-yen/356325', 'tuyen-quang.hau-chung': 'hau-chung/356326', 'tuyen-quang.na-hang': 'na-hang/356327', 'tuyen-quang.na-koc': 'na-koc/356328', 'tuyen-quang.tung-muong': 'tung-muong/356329', 'tuyen-quang.tuyen-quang': 'tuyen-quang/356319', 'lang-son.ban-re': 'ban-re/354296', 'lang-son.con-chon': 'con-chon/354297', 'lang-son.dong-dang': 'dong-dang/354298', 'lang-son.fac-ta': 'fac-ta/354299', 'lang-son.lang-ro': 'lang-ro/354300', 'lang-son.lang-son': 'lang-son/354293', 'lang-son.loc-binh': 'loc-binh/354301', 'lang-son.na-anh': 'na-anh/354302', 'lang-son.na-nhien': 'na-nhien/354295', 'lang-son.na-sam': 'na-sam/354303', 'lang-son.quinh-son': 'quinh-son/354304', 'lang-son.that-khe': 'that-khe/354294', 'quang-ninh.cam-pha': 'cam-pha/355737', 'quang-ninh.dam-ha': 'dam-ha/355740', 'quang-ninh.dong-trieu': 'dong-trieu/355741', 'quang-ninh.dong-vang': 'dong-vang/355742', 'quang-ninh.ha-dong': 'ha-dong/355743', 'quang-ninh.ha-long': 'ha-long/355736', 'quang-ninh.ke-phong': 'ke-phong/355744', 'quang-ninh.mong-cai': 'mong-cai/355739', 'quang-ninh.mong-duong': 'mong-duong/355745', 'quang-ninh.na-thiem': 'na-thiem/355746', 'quang-ninh.quang-hoai': 'quang-hoai/355747', 'quang-ninh.quang-yen': 'quang-yen/355748', 'quang-ninh.than-poun': 'than-poun/106544', 'quang-ninh.uong-bi': 'uong-bi/355738', 'quang-ninh.vang-danh': 'vang-danh/355749', 'hoa-binh.chi-ne': 'chi-ne/353985', 'hoa-binh.gieu-ca': 'gieu-ca/353986', 'hoa-binh.hoa-binh': 'hoa-binh/353983', 'hoa-binh.suoi-rut': 'suoi-rut/353984', 'hoa-binh.vi-ban': 'vi-ban/353988', 'hoa-binh.vinh-dong': 'vinh-dong/353989', 'hoa-binh.xom-lon': 'xom-lon/353990', 'ninh-binh.nho-quan': 'nho-quan/355450', 'ninh-binh.ninh-binh': 'ninh-binh/355447', 'ninh-binh.phat-diem': 'phat-diem/355448', 'ninh-binh.tay-phu': 'tay-phu/355449', 'thai-binh.da-coc': 'da-coc/356181', 'thai-binh.luc-linh': 'luc-linh/356178', 'thai-binh.phu-vat': 'phu-vat/356179', 'thai-binh.quan-bac': 'quan-bac/356180', 'thai-binh.thai-binh': 'thai-binh/356177', 'thanh-hoa.ba-lang': 'ba-lang/356190', 'thanh-hoa.bai-thuong': 'bai-thuong/356191', 'thanh-hoa.bien-son': 'bien-son/356186', 'thanh-hoa.binh-an': 'binh-an/356192', 'thanh-hoa.diem-phe': 'diem-phe/356193', 'thanh-hoa.dong-tau': 'dong-tau/356194', 'thanh-hoa.hoang-xa': 'hoang-xa/356195', 'thanh-hoa.ke-gi': 'ke-gi/356196', 'thanh-hoa.kien-trung': 'kien-trung/356197', 'thanh-hoa.lang-ke-man': 'lang-ke-man/356198', 'thanh-hoa.lang-men': 'lang-men/356199', 'thanh-hoa.muong-lat': 'muong-lat/356200', 'thanh-hoa.nghi-son': 'nghi-son/356187', 'thanh-hoa.nhu-xuan': 'nhu-xuan/356189', 'thanh-hoa.sam-son': 'sam-son/356185', 'thanh-hoa.thanh-hoa': 'thanh-hoa/356184', 'thanh-hoa.thiet-tra': 'thiet-tra/356201', 'thanh-hoa.truong-quang-tien': 'truong-quang-tien/356188', 'thanh-hoa.vinh-loc': 'vinh-loc/356202', 'thanh-hoa.xuan-hoa': 'xuan-hoa/356203', 'nghe-an.ban-cha-hang': 'ban-cha-hang/355423', 'nghe-an.ban-chieng': 'ban-chieng/355424', 'nghe-an.ban-ko-oi': 'ban-ko-oi/355425', 'nghe-an.ban-mong': 'ban-mong/355426', 'nghe-an.ban-na-ca': 'ban-na-ca/355427', 'nghe-an.bich-thi': 'bich-thi/355429', 'nghe-an.canh-trap': 'canh-trap/355430', 'nghe-an.duong-long': 'duong-long/355431', 'nghe-an.ky-son': 'ky-son/355418', 'nghe-an.lang-la': 'lang-la/355419', 'nghe-an.lang-rao': 'lang-rao/355432', 'nghe-an.lang-se': 'lang-se/355433', 'nghe-an.luong-khe': 'luong-khe/355434', 'nghe-an.muong-hin': 'muong-hin/355435', 'nghe-an.muong-hinh': 'muong-hinh/355436', 'nghe-an.na-ac': 'na-ac/355437', 'nghe-an.nghia-dan': 'nghia-dan/355438', 'nghe-an.phlen-loung': 'phlen-loung/355439', 'nghe-an.phuc-thanh': 'phuc-thanh/355440', 'nghe-an.qui-chau': 'qui-chau/355441', 'nghe-an.tam-le': 'tam-le/355442', 'nghe-an.tap-phuc': 'tap-phuc/355443', 'nghe-an.tien-yen': 'tien-yen/355420', 'nghe-an.tri-le': 'tri-le/355444', 'nghe-an.tuong-duong': 'tuong-duong/355421', 'nghe-an.vinh': 'vinh/355417', 'nghe-an.vinh-lai': 'vinh-lai/355445', 'nghe-an.xa-truc': 'xa-truc/355446', 'nghe-an.xen-con': 'xen-con/355422', 'ha-tinh.bau-mon': 'bau-mon/353423', 'ha-tinh.cau-thuong': 'cau-thuong/353424', 'ha-tinh.dien-xa': 'dien-xa/353425', 'ha-tinh.ha-tinh': 'ha-tinh/353418', 'ha-tinh.ho-thong': 'ho-thong/353419', 'ha-tinh.huong-son': 'huong-son/353420', 'ha-tinh.kim-cuong': 'kim-cuong/353421', 'ha-tinh.ky-anh': 'ky-anh/353426', 'ha-tinh.truc-lam': 'truc-lam/353427', 'ha-tinh.tuan-thuong': 'tuan-thuong/353428', 'ha-tinh.vinh-son': 'vinh-son/353429', 'ha-tinh.xom-con-si': 'xom-con-si/353422', 'ha-tinh.xuan-lung': 'xuan-lung/353430', 'quang-binh.cha-noi': 'cha-noi/355702', 'quang-binh.chap-le': 'chap-le/355703', 'quang-binh.dong-hoi': 'dong-hoi/355698', 'quang-binh.ho-xa': 'ho-xa/355699', 'quang-binh.kiem-long': 'kiem-long/355704', 'quang-binh.lang-mo': 'lang-mo/355705', 'quang-binh.ly-nhon-bac': 'ly-nhon-bac/355700', 'quang-binh.quang-ninh': 'quang-ninh/355701', 'quang-binh.quang-trach': 'quang-trach/355706', 'quang-binh.thanh-lang-xa': 'thanh-lang-xa/355707', 'quang-binh.xuan-bo': 'xuan-bo/355709', 'quang-binh.yen-lac': 'yen-lac/355710', 'quang-tri.bo-ho-su': 'bo-ho-su/355754', 'quang-tri.cam-lo': 'cam-lo/355755', 'quang-tri.cat-son-phuong': 'cat-son-phuong/355750', 'quang-tri.dong-ha': 'dong-ha/426609', 'quang-tri.khe-sanh': 'khe-sanh/355756', 'quang-tri.mui-lay': 'mui-lay/355757', 'quang-tri.pho-trach': 'pho-trach/355758', 'quang-tri.quang-tri': 'quang-tri/355759', 'quang-tri.thon-khe-xeng': 'thon-khe-xeng/355760', 'quang-tri.thon-my-chanh': 'thon-my-chanh/355761', 'quang-tri.thon-my-thuy': 'thon-my-thuy/355762', 'quang-tri.thon-thai-duong-ha': 'thon-thai-duong-ha/355753', 'quang-tri.tou-rout': 'tou-rout/355763', 'thua-thien-hue.hue': 'hue/356204', 'thua-thien-hue.huong-thuy': 'huong-thuy/356205', 'thua-thien-hue.mui-chon-dong': 'mui-chon-dong/356207', 'thua-thien-hue.nong-truong': 'nong-truong/356209', 'thua-thien-hue.nong-truong-nam-dong': 'nong-truong-nam-dong/356206', 'thua-thien-hue.phu-loc': 'phu-loc/356210', 'thua-thien-hue.thon-phu-an': 'thon-phu-an/356211', 'quang-nam.ai-yin-young': 'ai-yin-young/355720', 'quang-nam.ben-giang': 'ben-giang/355721', 'quang-nam.dien-ban': 'dien-ban/355713', 'quang-nam.ha-nong-trung': 'ha-nong-trung/355714', 'quang-nam.hiep-duc': 'hiep-duc/355715', 'quang-nam.hoi-an': 'hoi-an/355711', 'quang-nam.kham-duc': 'kham-duc/355722', 'quang-nam.khuong-trung': 'khuong-trung/355716', 'quang-nam.phu-binh': 'phu-binh/355717', 'quang-nam.phu-xuan-ha': 'phu-xuan-ha/355723', 'quang-nam.tam-ky': 'tam-ky/355712', 'quang-nam.thang-binh': 'thang-binh/355718', 'quang-nam.thon-hai': 'thon-hai/355719', 'quang-nam.thuong-duc': 'thuong-duc/355724', 'quang-nam.tien-phuoc': 'tien-phuoc/355725', 'quang-nam.tra-mi': 'tra-mi/355726', 'kon-tum.chuong-nghia': 'chuong-nghia/354243', 'kon-tum.cong-co-do': 'cong-co-do/354244', 'kon-tum.dak-chat': 'dak-chat/354247', 'kon-tum.dak-pec': 'dak-pec/354245', 'kon-tum.goranh': 'goranh/354249', 'kon-tum.kon-braih': 'kon-braih/354250', 'kon-tum.kon-honong': 'kon-honong/354251', 'kon-tum.kon-tum': 'kon-tum/354242', 'kon-tum.mang-ri': 'mang-ri/354253', 'kon-tum.plei-can': 'plei-can/354246', 'kon-tum.polei-breng': 'polei-breng/354254', 'kon-tum.sa-thay': 'sa-thay/354256', 'kon-tum.tan-canh': 'tan-canh/354257', 'kon-tum.tri-dao': 'tri-dao/354258', 'quang-ngai.an-hai': 'an-hai/355728', 'quang-ngai.gia-vuc': 'gia-vuc/355732', 'quang-ngai.phuoc-thinh': 'phuoc-thinh/355729', 'quang-ngai.quang-ngai': 'quang-ngai/355727', 'quang-ngai.sa-huynh': 'sa-huynh/355733', 'quang-ngai.thanh-thuy': 'thanh-thuy/355734', 'quang-ngai.tra-bong': 'tra-bong/355735', 'quang-ngai.tuyet-diem': 'tuyet-diem/355730', 'quang-ngai.van-ly': 'van-ly/355731', 'gia-lai.a-yun-pa': 'a-yun-pa/353271', 'gia-lai.an-khe': 'an-khe/353272', 'gia-lai.ban-bat': 'ban-bat/353273', 'gia-lai.ban-xa-thu': 'ban-xa-thu/353274', 'gia-lai.de-pouang': 'de-pouang/353266', 'gia-lai.dinh-dien-dak-quon': 'dinh-dien-dak-quon/353267', 'gia-lai.phu-nhon': 'phu-nhon/353275', 'gia-lai.plei-doch': 'plei-doch/353276', 'gia-lai.plei-ken-ngo': 'plei-ken-ngo/353268', 'gia-lai.plei-khoie': 'plei-khoie/353277', 'gia-lai.plei-klane-kla': 'plei-klane-kla/353269', 'gia-lai.plei-kuel': 'plei-kuel/353278', 'gia-lai.plei-morr': 'plei-morr/353279', 'gia-lai.plei-rongol-dogrong': 'plei-rongol-dogrong/353270', 'gia-lai.pleiku': 'pleiku/353265', 'gia-lai.thang-duc': 'thang-duc/353280', 'gia-lai.xuong-kuang': 'xuong-kuang/353281', 'binh-dinh.an-lao': 'an-lao/352240', 'binh-dinh.bong-son': 'bong-son/352232', 'binh-dinh.chan-an': 'chan-an/352241', 'binh-dinh.dinh-binh': 'dinh-binh/352233', 'binh-dinh.duong-lieu': 'duong-lieu/352234', 'binh-dinh.huu-giang': 'huu-giang/352235', 'binh-dinh.phu-an': 'phu-an/352243', 'binh-dinh.phu-cat': 'phu-cat/352244', 'binh-dinh.phu-xuan': 'phu-xuan/352236', 'binh-dinh.quy-nhon': 'quy-nhon/171', 'binh-dinh.tam-quan': 'tam-quan/352237', 'binh-dinh.van-canh': 'van-canh/352245', 'binh-dinh.van-thien': 'van-thien/352238', 'binh-dinh.vinh-phuc': 'vinh-phuc/352239', 'phu-yen.ban-thach': 'ban-thach/355600', 'phu-yen.binh-thanh': 'binh-thanh/355601', 'phu-yen.cung-son': 'cung-son/355596', 'phu-yen.dan-phu': 'dan-phu/355598', 'phu-yen.dong-xuan': 'dong-xuan/355602', 'phu-yen.phu-giang': 'phu-giang/355599', 'phu-yen.phuoc-lanh': 'phuoc-lanh/355603', 'phu-yen.tuy-hoa': 'tuy-hoa/355595', 'dak-lak.ban-ae-lai': 'ban-ae-lai/352960', 'dak-lak.ban-ay-rieng': 'ban-ay-rieng/352961', 'dak-lak.ban-don': 'ban-don/352962', 'dak-lak.ban-mdrack': 'ban-mdrack/352957', 'dak-lak.buon-ma': 'buon-ma/352963', 'dak-lak.buon-ma-thuot': 'buon-ma-thuot/352955', 'dak-lak.buon-mrong': 'buon-mrong/352958', 'dak-lak.buon-phoke': 'buon-phoke/352964', 'dak-lak.buon-ya-soup': 'buon-ya-soup/352965', 'dak-lak.nong-trai': 'nong-trai/352966', 'dak-lak.quang-nhieu': 'quang-nhieu/352959', 'dak-lak.xa-tho-thanh': 'xa-tho-thanh/352967', 'khanh-hoa.ap-duc-my': 'ap-duc-my/354229', 'khanh-hoa.cam-lam': 'cam-lam/354223', 'khanh-hoa.cam-ranh': 'cam-ranh/354224', 'khanh-hoa.dien-khanh': 'dien-khanh/354225', 'khanh-hoa.khanh-son': 'khanh-son/354232', 'khanh-hoa.khanh-vinh': 'khanh-vinh/354230', 'khanh-hoa.nha-trang': 'nha-trang/354222', 'khanh-hoa.ninh-hoa': 'ninh-hoa/354226', 'khanh-hoa.ninh-ma': 'ninh-ma/354227', 'khanh-hoa.ninh-phuoc': 'ninh-phuoc/354228', 'khanh-hoa.van-ninh': 'van-ninh/354231', 'khanh-hoa.xom-my-ca': 'xom-my-ca/354233', 'lam-dong.ap-tan-my': 'ap-tan-my/354289', 'lam-dong.ap-thanh-huong': 'ap-thanh-huong/354290', 'lam-dong.da-lat': 'da-lat/354287', 'lam-dong.di-linh': 'di-linh/354291', 'lam-dong.dong-krola': 'dong-krola/354292', 'lam-dong.phu-hoi': 'phu-hoi/354288', 'ninh-thuan.an-phuoc': 'an-phuoc/355455', 'ninh-thuan.du-long': 'du-long/355453', 'ninh-thuan.lang-ong': 'lang-ong/355456', 'ninh-thuan.phan-rang-thap-cham': 'phan-rang-thap-cham/355452', 'ninh-thuan.thon-bao-an': 'thon-bao-an/355454', 'ninh-thuan.thon-do-vinh': 'thon-do-vinh/355457', 'ninh-thuan.thon-lac-nghiep': 'thon-lac-nghiep/355458', 'ninh-thuan.thon-son-hai': 'thon-son-hai/355459', 'ninh-thuan.thon-song-pha': 'thon-song-pha/355460', 'ninh-thuan.thon-thai-an': 'thon-thai-an/355461', 'tay-ninh.bo-tuc': 'bo-tuc/356174', 'tay-ninh.go-dau-ha': 'go-dau-ha/356175', 'tay-ninh.loc-ninh': 'loc-ninh/356173', 'tay-ninh.tay-ninh': 'tay-ninh/356171', 'tay-ninh.trang-bang': 'trang-bang/356172', 'dong-nai.ap-tham-thien': 'ap-tham-thien/353027', 'dong-nai.bien-hoa': 'bien-hoa/353021', 'dong-nai.cam-my-1': 'cam-my/353024', 'dong-nai.cam-my-2': 'cam-my/353025', 'dong-nai.dong-sai': 'dong-sai/353026', 'dong-nai.phu-giao': 'phu-giao/353028', 'dong-nai.xa-gia-kiem': 'xa-gia-kiem/353030', 'dong-nai.xa-phuong-lam': 'xa-phuong-lam/353031', 'dong-nai.xa-vo-dat': 'xa-vo-dat/353022', 'dong-nai.xuan-loc': 'xuan-loc/353023', 'binh-thuan.ap-long-hoa': 'ap-long-hoa/352263', 'binh-thuan.ap-rung-la': 'ap-rung-la/352269', 'binh-thuan.ap-tam-tan': 'ap-tam-tan/352267', 'binh-thuan.ap-thien-ai': 'ap-thien-ai/352271', 'binh-thuan.bao-loc': 'bao-loc/352265', 'binh-thuan.da-hoa': 'da-hoa/352272', 'binh-thuan.dinh-dien-dak-menou': 'dinh-dien-dak-menou/352273', 'binh-thuan.hai-long': 'hai-long/352274', 'binh-thuan.ham-tan': 'ham-tan/352266', 'binh-thuan.ham-thuan-bac': 'ham-thuan-bac/352275', 'binh-thuan.hoa-da': 'hoa-da/352268', 'binh-thuan.ke-ga': 'ke-ga/352276', 'binh-thuan.lagi': 'lagi/352277', 'binh-thuan.phan-ly': 'phan-ly/352270', 'binh-thuan.phan-thiet': 'phan-thiet/352262', 'binh-thuan.pho-tri': 'pho-tri/352279', 'binh-thuan.tuy-phong': 'tuy-phong/352280', 'binh-thuan.xa-hieu-tin': 'xa-hieu-tin/352281', 'binh-thuan.xa-muong-man': 'xa-muong-man/352282', 'binh-thuan.xa-phu-sung': 'xa-phu-sung/352283', 'binh-thuan.xa-song-luy': 'xa-song-luy/352264', 'long-an.ap-bac': 'ap-bac/354475', 'long-an.ap-binh-chau': 'ap-binh-chau/354473', 'long-an.ap-ca-hoan': 'ap-ca-hoan/354476', 'long-an.ap-moi': 'ap-moi/354477', 'long-an.binh-phuoc': 'binh-phuoc/354474', 'long-an.can-duoc': 'can-duoc/354478', 'long-an.hau-nghia': 'hau-nghia/354471', 'long-an.tan-an': 'tan-an/354470', 'long-an.thu-thua': 'thu-thua/354472', 'vung-tau.ap-binh-chau': 'ap-binh-chau/352096', 'vung-tau.ba-ria': 'ba-ria/352095', 'vung-tau.chau-thanh': 'chau-thanh/352091', 'vung-tau.cho-phuoc-hai': 'cho-phuoc-hai/352090', 'vung-tau.co-ong': 'co-ong/428244', 'vung-tau.dat-do': 'dat-do/352092', 'vung-tau.grande-village-de-poulo-condore': 'grande-village-de-poulo-condore/427812', 'vung-tau.long-le': 'long-le/352094', 'vung-tau.vung-tau': 'vung-tau/352089', 'vung-tau.xa-binh-gia': 'xa-binh-gia/352097', 'an-giang.chau-doc': 'chau-doc/351821', 'an-giang.cho-moi': 'cho-moi/351822', 'an-giang.long-xuyen': 'long-xuyen/351820', 'an-giang.phu-chau': 'phu-chau/351824', 'an-giang.tinh-bien': 'tinh-bien/351825', 'an-giang.tri-ton': 'tri-ton/351826', 'an-giang.xom-khanh-hoa': 'xom-khanh-hoa/351827', 'dong-thap.cao-lanh': 'cao-lanh/353033', 'dong-thap.sa-dec': 'sa-dec/353032', 'tien-giang.ben-tranh': 'ben-tranh/356216', 'tien-giang.cai-be': 'cai-be/356214', 'tien-giang.cai-lay': 'cai-lay/356215', 'tien-giang.go-cong': 'go-cong/356213', 'tien-giang.my-tho': 'my-tho/356212', 'tien-giang.xom-cua-tieu': 'xom-cua-tieu/356218', 'tien-giang.xom-vam-lang': 'xom-vam-lang/356217', 'kien-giang.an-bien': 'an-bien/354239', 'kien-giang.ap-luc': 'ap-luc/354234', 'kien-giang.chau-thanh': 'chau-thanh/354235', 'kien-giang.ha-tien': 'ha-tien/354236', 'kien-giang.phu-quoc': 'phu-quoc/354237', 'kien-giang.rach-gia': 'rach-gia/4493', 'kien-giang.xom-ba-trai': 'xom-ba-trai/354238', 'vinh-long.ap-an-dien': 'ap-an-dien/356355', 'vinh-long.tra-on': 'tra-on/6803', 'vinh-long.vinh-long': 'vinh-long/356354', 'ben-tre.ap-an-thuan': 'ap-an-thuan/352227', 'ben-tre.ben-tre': 'ben-tre/352226', 'ben-tre.lomg-ho': 'lomg-ho/352231', 'ben-tre.thanh-phong': 'thanh-phong/352228', 'ben-tre.thanh-phu': 'thanh-phu/352229', 'ben-tre.thoi-thuan': 'thoi-thuan/352230', 'tra-vinh.ap-ca-coi': 'ap-ca-coi/356250', 'tra-vinh.ap-tram': 'ap-tram/356251', 'tra-vinh.ba-dong': 'ba-dong/356252', 'tra-vinh.mac-bat': 'mac-bat/356253', 'tra-vinh.tieu-can': 'tieu-can/356249', 'tra-vinh.tra-vinh': 'tra-vinh/356248', 'soc-trang.ap-dau-giong': 'ap-dau-giong/355940', 'soc-trang.dai-ngai': 'dai-ngai/355943', 'soc-trang.giong-me': 'giong-me/355941', 'soc-trang.long-phu': 'long-phu/355944', 'soc-trang.soc-trang': 'soc-trang/355938', 'soc-trang.vinh-quoi': 'vinh-quoi/355942', 'bac-kan.bac-can': 'bac-can/352107', 'bac-kan.ban-duong': 'ban-duong/352109', 'bac-kan.ban-kao': 'ban-kao/356322', 'bac-kan.cho-moi': 'cho-moi/352108', 'bac-kan.con-houa': 'con-houa/352110', 'bac-kan.na-bioc': 'na-bioc/352111', 'bac-kan.tie-co': 'tie-co/352112', 'bac-giang.bac-giang': 'bac-giang/352098', 'bac-giang.bien-dong': 'bien-dong/352099', 'bac-giang.duc-thang': 'duc-thang/352100', 'bac-giang.lang-cha': 'lang-cha/352101', 'bac-giang.lang-duong': 'lang-duong/352102', 'bac-giang.luc-nam': 'luc-nam/352103', 'bac-giang.nam-dien': 'nam-dien/352104', 'bac-giang.tan-an-thon': 'tan-an-thon/352106', 'bac-lieu.ap-vinh-an-1': 'ap-vinh-an/352115', 'bac-lieu.ap-vinh-an-2': 'ap-vinh-an/352116', 'bac-lieu.bac-lieu': 'bac-lieu/352113', 'bac-lieu.gia-rai': 'gia-rai/352114', 'bac-lieu.xom-vam-cai-cung': 'xom-vam-cai-cung/352117', 'bac-ninh.bac-ninh': 'bac-ninh/352118', 'bac-ninh.dong-chue': 'dong-chue/352119', 'bac-ninh.ngoc-tri': 'ngoc-tri/352120', 'binh-duong.ap-bau-bang': 'ap-bau-bang/352249', 'binh-duong.dau-tieng': 'dau-tieng/352248', 'binh-duong.di-an': 'di-an/352247', 'binh-duong.tan-uyen': 'tan-uyen/352250', 'binh-duong.thu-dau-mot': 'thu-dau-mot/352246', 'binh-duong.xom-ben-oan': 'xom-ben-oan/352251', 'binh-duong.xom-trum-thap': 'xom-trum-thap/352252', 'binh-phuoc.ap-loc-thanh': 'ap-loc-thanh/352256', 'binh-phuoc.ba-ra': 'ba-ra/352255', 'binh-phuoc.cu-xa-cong-chuc': 'cu-xa-cong-chuc/427639', 'binh-phuoc.dang-boa': 'dang-boa/352257', 'binh-phuoc.dia-diem-bunard': 'dia-diem-bunard/352258', 'binh-phuoc.dong-phu': 'dong-phu/352261', 'binh-phuoc.dong-xoai': 'dong-xoai/426222', 'binh-phuoc.hon-quan': 'hon-quan/352253', 'binh-phuoc.phuoc-binh': 'phuoc-binh/352259', 'binh-phuoc.phuoc-hoa': 'phuoc-hoa/352260', 'ca-mau.ap-nha-may': 'ap-nha-may/352501', 'ca-mau.ca-mau': 'ca-mau/352499', 'ca-mau.cai-nuoc': 'cai-nuoc/352502', 'ca-mau.duong-keo': 'duong-keo/352503', 'ca-mau.ngoc-hien': 'ngoc-hien/352507', 'ca-mau.rach-tau': 'rach-tau/352500', 'ca-mau.tan-an': 'tan-an/352504', 'ca-mau.thoi-binh': 'thoi-binh/352505', 'hai-duong.chi-ngai': 'chi-ngai/353503', 'hai-duong.hai-duong': 'hai-duong/353501', 'hai-duong.ninh-giang': 'ninh-giang/353502', 'hai-duong.pha-lai': 'pha-lai/353504', 'ha-nam.phu-ly': 'phu-ly/353404', 'ha-nam.tao-thon': 'tao-thon/353405', 'hung-yen.ban-yen-nhan': 'ban-yen-nhan/353996', 'hung-yen.cao-quan': 'cao-quan/353997', 'hung-yen.dong-ly': 'dong-ly/353993', 'hung-yen.dong-tao-dong': 'dong-tao-dong/353994', 'hung-yen.hoa-binh': 'hoa-binh/353995', 'hung-yen.hung-yen': 'hung-yen/353992', 'hung-yen.thuy-linh': 'thuy-linh/414306', 'nam-dinh.coc-thanh': 'coc-thanh/355086', 'nam-dinh.long-chau': 'long-chau/355087', 'nam-dinh.nam-dinh': 'nam-dinh/355085', 'nam-dinh.nam-ha': 'nam-ha/355092', 'nam-dinh.ninh-cuong': 'ninh-cuong/355088', 'nam-dinh.phu-nhi': 'phu-nhi/355089', 'nam-dinh.quan-phuong-ha': 'quan-phuong-ha/355090', 'nam-dinh.quan-phuong-trung-trai': 'quan-phuong-trung-trai/355091', 'nam-dinh.thuan-nghiep': 'thuan-nghiep/355093', 'nam-dinh.van-lam-trai': 'van-lam-trai/355094', 'phu-tho.huu-do': 'huu-do/355593', 'phu-tho.phu-tho': 'phu-tho/355588', 'phu-tho.sang-huan': 'sang-huan/355589', 'phu-tho.tho-khoi': 'tho-khoi/355590', 'phu-tho.vien-minh': 'vien-minh/355591', 'phu-tho.viet-tri': 'viet-tri/356356', 'phu-tho.xom-con': 'xom-con/355592', 'phu-tho.xom-tang': 'xom-tang/355594', 'thai-nguyen.binh-long': 'binh-long/356183', 'thai-nguyen.thai-nguyen': 'thai-nguyen/356182', 'vinh-phuc.vinh-yen': 'vinh-yen/356357', 'dien-bien.ban-cong-deng': 'ban-cong-deng/353006', 'dien-bien.ban-na-pheo': 'ban-na-pheo/353007', 'dien-bien.ban-nam-nen': 'ban-nam-nen/353008', 'dien-bien.ban-pa-huone': 'ban-pa-huone/353003', 'dien-bien.ban-po-bai': 'ban-po-bai/353009', 'dien-bien.ban-veng': 'ban-veng/353010', 'dien-bien.deo-tay-chang': 'deo-tay-chang/353011', 'dien-bien.dien-bien': 'dien-bien/353001', 'dien-bien.dien-bien-phu': 'dien-bien-phu/353002', 'dien-bien.giang-mung-pho': 'giang-mung-pho/353004', 'dien-bien.luan-chau': 'luan-chau/353013', 'dien-bien.muong-tong-1': 'muong-tong/353014', 'dien-bien.muong-tong-2': 'muong-tong/353005', 'dien-bien.tua-chua': 'tua-chua/353015', 'dak-nong.ap-bich-son': 'ap-bich-son/352969', 'dak-nong.duc-lao': 'duc-lao/352970', 'dak-nong.duc-minh': 'duc-minh/352971', 'dak-nong.gia-nghia': 'gia-nghia/352968', 'hau-giang.ap-phu-nhon': 'ap-phu-nhon/353560', 'hau-giang.long-my': 'long-my/353561', 'hau-giang.rach-goi': 'rach-goi/353562', 'hau-giang.vi-thanh': 'vi-thanh/353559', 'can-tho.can-tho': 'can-tho/352508', 'can-tho.o-mon': 'o-mon/352509', 'can-tho.thot-not': 'thot-not/352510', 'da-nang.ap-huong-phuoc': 'ap-huong-phuoc/352952', 'da-nang.da-nang': 'da-nang/352954', 'da-nang.mui-da-nang': 'mui-da-nang/352953', 'ha-noi.bach-mai': 'bach-mai/353408', 'ha-noi.bat-trang': 'bat-trang/429880', 'ha-noi.cu-dong': 'cu-dong/427684', 'ha-noi.dong-cao': 'dong-cao/353410', 'ha-noi.dong-nhan': 'dong-nhan/353406', 'ha-noi.dong-sang': 'dong-sang/353414', 'ha-noi.gia-lam-pho': 'gia-lam-pho/425925', 'ha-noi.ha-dong': 'ha-dong/425639', 'ha-noi.hanoi': 'hanoi/353412', 'ha-noi.noi-xa': 'noi-xa/353417', 'ha-noi.phuc-yen': 'phuc-yen/353411', 'ha-noi.phuong-tri': 'phuong-tri/353415', 'ha-noi.son-tay': 'son-tay/353413', 'ha-noi.van-ho': 'van-ho/353407', 'ha-noi.van-la': 'van-la/353416', 'ha-noi.vinh-phuc': 'vinh-phuc/353409', 'hai-phong.cuu-doi': 'cuu-doi/353510', 'hai-phong.do-son': 'do-son/353509', 'hai-phong.ha-ly': 'ha-ly/353505', 'hai-phong.haiphong': 'haiphong/353511', 'hai-phong.kien-an': 'kien-an/353507', 'hai-phong.thuy-u': 'thuy-u/353508', 'ho-chi-minh.ben-co': 'ben-co/353980', 'ho-chi-minh.can-giuoc': 'can-giuoc/353979', 'ho-chi-minh.cho-lon': 'cho-lon/353971', 'ho-chi-minh.cu-chi': 'cu-chi/353977', 'ho-chi-minh.da-kao': 'da-kao/353972', 'ho-chi-minh.gia-dinh': 'gia-dinh/353973', 'ho-chi-minh.khanh-hoi': 'khanh-hoi/353974', 'ho-chi-minh.nha-be': 'nha-be/353978', 'ho-chi-minh.ho-chi-minh-city': 'ho-chi-minh-city/353981'}

def setup(hass, config):

    def get_info_weather(data_call):
        
        place_id = data_call.data.get(CONF_PLACE)
        tts_service = data_call.data.get(CONF_TTS_SERVICE)
        entity_id = data_call.data.get(CONF_ENTITY_ID)
        if tts_service == 'tts.google_say':
            cache = data_call.data.get(CONF_CACHE, 'false')
        elif tts_service == 'tts_fpt.say':
            voice_type = data_call.data.get(CONF_VOICE, 'nu_mien_bac')
        
        place_id = places.get(place_id)
        id_ = place_id.split('/')[1]
        prefix_url = 'https://www.accuweather.com/vi/vn/'
        type_forecast = '/daily-weather-forecast/'
        url = prefix_url + place_id + type_forecast + id_
        headers = {"User-Agent":"Mozilla/5.0"}
        res = requests.get(url, headers=headers).text
        soup = bs(res, "lxml")
        class_info = soup.findAll('div', attrs={"class": "info"})
        
        att_large_temp = {'class': 'large-temp'}
        att_small_temp = {'class': 'small-temp'}
        att_cond = {'class': 'cond'}
        ichk = 0
        hom_nay = "Thời tiết hôm nay: "
        dem_nay = "Thời tiết đêm nay: "
        ngay_mai = "Ngày mai: "
        ngay_kia = "Ngày kia: "
        nhietdo = ", nhiệt độ "
        nhietdotu = ", nhiệt độ từ "
        do = " độ xê. "
        den = " đến "
        sic = "°"
        for c_info in class_info:
            if ichk < 3:
                if c_info.find('span', attrs=att_small_temp):
                    ichk += 1
                    temp1 =  (c_info.findAll('span', attrs=att_small_temp)[0].text)[1:3].replace(sic, "")
                    temp2 =  (c_info.findAll('span', attrs=att_large_temp)[0].text)[0:2].replace(sic, "")
                    cond = c_info.findAll('span', attrs=att_cond)[0].text
                    stext = cond + nhietdotu + temp1 + den + temp2 + do 
                    if ichk == 1:
                        if len(temp1) == 0:
                            text_weather = dem_nay + cond + nhietdo + temp2 + do
                        else:
                            text_weather = hom_nay + stext
                    elif ichk == 2:
                        text_weather = text_weather + ngay_mai + stext
                    elif ichk == 3:
                        text_weather = text_weather + ngay_kia + stext
        ## result info weather               
        text_weather = text_weather[0:1000]
        ## service data
        if tts_service == 'tts.google_say':
            service_data = {'entity_id': entity_id, 'message': text_weather, 'cache': cache}
        elif tts_service == 'tts_fpt.say':
            service_data = {'entity_id': entity_id, 'message': text_weather, 'voice_type': voice_type}
        ## call service on Home assistant
        hass.services.call(tts_service.split('.')[0], tts_service.split('.')[1], service_data)
        
    hass.services.register(DOMAIN, SERVICE_GETINFO, get_info_weather)
    return True

